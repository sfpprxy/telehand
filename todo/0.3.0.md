准备实现&发布 0.3.0

# 实现规则

自底向上的进行实现, 完成一个子任务后就用 Markdown 语法标记完成。但是如果在任何过程中遇到了问题，则在子任务下新建一个子任务并描述问题，解决完问题也标记完成。一般来说现有的任务内容不需要改动，如需改动停下来征求我同意。

# 0.3.0 目标：多 Peer Fallback + 低延迟优先，降低单一 Peer 不稳定导致的连接失败

## 方案与待实现（按依赖顺序，含常量）

- [x] Peer 池与输入标准化
  - [x] 新增 `peer_pool.go`：`Config.Peers` 视为候选池，统一做 trim / 去重 / 非法地址过滤。
  - [x] 将 `DefaultPeers` 从单地址升级为多地址列表，并和用户传入 peers 合并（用户 peers 在同延迟下优先）。
  - [x] 常量：`DefaultPeerCount=8`、`MaxPeerCount=32`、`InvalidPeerDrop=true`。
- [x] 单次延迟探测与排序
  - [x] 新增 `peer_selector.go`：每个 peer 仅测 1 次延迟，不做复杂评分。
  - [x] 延迟超时视为不可用；可用 peer 按延迟升序，不可用 peer 放到队尾（或直接跳过）。
  - [x] 常量：`PeerProbeSampleCount=1`、`PeerProbeTimeout=800ms`、`PeerProbeConcurrency=4`、`PeerProbeUnreachableLatency=9999ms`。
- [x] 接入 connect/serve 启动流程
  - [x] `runConnect/runServe` 输出“本轮排序后的 peer 列表（脱敏）”，便于排障。
  - [x] `EasyTier.Start` 使用“排序后的 peers”作为 `--peers` 参数顺序。
  - [x] 常量：`EasyTierWaitIPTimeout=16s`（沿用现有值）。
- [x] 连接状态机接入 peer fallback（先 peer，后 subnet）
  - [x] 在 `runtime_session.go connectLoop` 中增加 peer 轮次：同一子网内按排序逐个尝试 peer。
  - [x] 单 peer 失败即切下一个；当该子网全部 peers 失败后，再切下一个子网 candidate。
  - [x] 常量：`CandidateMaxChecks=3`、`StatePollInterval=500ms`、`SubnetCandidateCount=8`。
  - [x] reason code 增加：`peer_fallback_next`、`peer_all_failed_switch_subnet`、`peer_probe_degraded`。
- [x] running 阶段守护与重连
  - [x] 保留现有 running 保护与失败阈值，触发异常时先按已排序 peers 重连，再必要时切 subnet。
  - [x] `peer connection removed` 高频抖动时记录并触发 fallback，不直接判死整个会话。
  - [x] 常量：`RunningConsecutiveFailed=3`、`RunningProbeTimeout=500ms`、`PeerRemovedBurstThreshold=3/10s`、`CandidateLogLimiterTTL=10s`。
- [x] 配置与文档对齐
  - [x] 配对码继续保留 peers 数组；运行时允许按“本轮单次延迟测量”重排连接顺序。
  - [x] README、命令帮助、示例输出统一为“多 peer + 低延迟优先 + fallback”语义。

## 测试与验收

- [x] 单元测试
  - [x] `parsePeers`/标准化/去重/非法输入过滤。
  - [x] 单次探测排序（最低延迟优先、超时节点排后/剔除）。
  - [x] fallback 状态机分支：仅首 peer 故障、前 N 个故障、全部故障、恢复后回升。
- [x] 集成测试（可 mock）
  - [x] 构造“首 peer 不可达，次 peer 可达”并验证自动进入 running。
  - [x] 构造“peer removed 抖动”并验证不会无限卡在单 peer。
  - [x] 构造“route conflict + peer 健康”并验证优先保留路由冲突判定。
- [ ] 实机验证
  - [ ] 使用一组已知公共节点（含高延迟/不稳定节点）验证最终命中低延迟稳定 peer。
  - [ ] 验证断网恢复后可重新测一次延迟并切回可用 peer。
  - [ ] 验证 CLI/Web 均能看到当前使用 peer 与最近切换原因。
  - [ ] 问题跟踪：双方已拿到虚拟 IP，但 Win/Mac Web UI 均看不到对端
    - [ ] 现象：日志长期停在 `bootstrap_connected` / `peer_wait_business_endpoint`，`target_ip=-`，无法进入 `running`。
    - [ ] 影响：双方页面 `Peer Info` 只见本端或无业务端节点，无法建立可用会话。
    - [ ] 验收：同一配对码下双方最终都进入 `running`，且两端 Web UI `Peer Info` 可互见对端节点。

## 0.3.0 补充修复（已完成）

- [x] 连接阶段可中断退出（`Ctrl+C`）
  - [x] `runSession` 停止信号改为广播式 stop channel，连接阶段与 running 阶段都可及时感知。
  - [x] `connectWithPeerFallback` 各层循环接入 stop 检查，避免连接中卡死无法退出。
  - [x] `WaitForIP` 改为可中断等待（收到 stop 后立即返回中断并停止 EasyTier 实例）。
- [x] `event_snapshot_error` 导致的候选评估无限循环收敛
  - [x] `evaluateCandidateConnectivity` 增加评估时间窗上限（按 checks/interval/probe timeout 预算）。
  - [x] 在事件流中将 `event_snapshot_error` 计入 `maxChecks` 预算，达到阈值后退出当前 candidate。
  - [x] 新增/更新测试覆盖“中断退出”“snapshot error 达预算退出”。
- [x] Web UI（connecting 阶段）`Peer Info` 显示修复
  - [x] 后端短时返回空快照时，前端保留最近一次非空 `Peer Info`（标记为缓存），不再整表清空。
  - [x] 若暂无非空快照但已有 `current_peer`，显示 fallback 行（候选 peer/自身占位）而非“空白等待”。
  - [x] 修复命令/日志复制按钮的前端变量错误，避免 JS 异常影响页面交互。
- [x] peer fallback 尝试语义修复（`peer attempt i/n` 实际只连当前单 peer）
  - [x] `connectWithPeerFallback` 每轮 attempt 改为仅传当前 peer（`peerCfg.Peers = []string{peer}`），不再把整组 peers 一起传给 EasyTier。
  - [x] 修正由此导致的“日志显示 1/2，但底层 2 个 bootstrap 同时连接”行为偏差。
  - [x] 更新对应测试断言，确保每次启动仅包含单个目标 peer。
- [x] Web UI（connecting 阶段）`Peer Info` 闪烁修复（self-only 快照）
  - [x] 区分“非空快照”和“含非 self peer 快照”，新增非 self 缓存与短 TTL（6s）策略。
  - [x] 当新快照仅含 self 行时，短时间内合并最近非 self peers（标记缓存），避免“消失-出现”抖动。
- [x] bootstrap_only 场景连接策略修复（避免反复重建连接）
  - [x] 当 `peer_class in {bootstrap_only, business_peer_waiting_virtual_ip}` 且链路稳定（`non_self_present=true`、`peer_query_failures=0`）时，保持当前 peer 持续等待业务端，不立即 `peer_fallback_next`。
  - [x] 新增 reason：`peer_wait_business_endpoint`，并同步 connecting 状态文案。
  - [x] 新增测试覆盖：同一 peer 先 `bootstrap_only` 后 `peer_ready` 时，保持单 peer 启动并在当前 peer 内完成就绪。
  - [x] 增加“等待窗口后再切换”策略：`bootstrap` 持续等待超过 `BootstrapWaitTimeout=12s` 仍未看到业务端时，自动切下一个 peer，避免卡在单一 bootstrap。
  - [x] 新增测试覆盖：`bootstrap_only` 长时间无进展时，会从 `peer attempt=1/2` 切换到 `2/2`（而非无限等待）。
